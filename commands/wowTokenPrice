const {  SlashCommandBuilder } = require('@discordjs/builders');
const { getBlizzardApiKey } = require('../helpers/AuthHelpers.js');
const fetch = require("node-fetch");

module.exports = {
	data: new SlashCommandBuilder()
		.setName('wowtokenprice')
		.setDescription('Get wow token price'),
	async execute(interaction) {
        const token = await getBlizzardApiKey()
        
        const requestOptions = {
            method: 'POST',
            headers: {
                Authorization: `Basic ${config.BLIZZARD_TOKEN}`
            },
            redirect: 'follow'
        }
        const url = `https://us.api.blizzard.com/data/wow/token/index?namespace=dynamic-us&locale=en_US&access_token=${token}`
        const resp = await fetch(url, requestOptions)
        const res = await resp.json()

		interaction.reply(`Wow token price is: ${res.price}`)
        interaction.deleteReply()
	}
};